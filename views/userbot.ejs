<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuration Userbot - Telegram Bot</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .code-box {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      margin: 10px 0;
      word-break: break-all;
    }
    .step-guide {
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .step-guide h4 {
      color: #333;
      margin-top: 0;
    }
    .step-guide ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    .step-guide li {
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <%- include('partials/header') %>
    <%- include('partials/nav') %>

    <div class="section">
      <h2>ü§ñ Configuration Userbot Telegram</h2>
      <p class="subtitle">Configurez votre compte utilisateur Telegram pour le bot</p>

      <div class="warning-box">
        <strong>‚ö†Ô∏è IMPORTANT :</strong> Cette configuration convertit le bot en <strong>userbot</strong> (compte utilisateur automatis√©).
        <br><br>
        <strong>Risques :</strong>
        <ul>
          <li>‚ùå Viole techniquement les conditions d'utilisation de Telegram</li>
          <li>‚ö†Ô∏è Risque de ban du compte si utilis√© commercialement</li>
          <li>üîê N√©cessite un num√©ro de t√©l√©phone r√©el</li>
        </ul>
        <strong>Recommandation :</strong> Utilisez un num√©ro de t√©l√©phone d√©di√©, pas votre num√©ro principal !
      </div>

      <div class="step-guide">
        <h4>üìã √âtape 1 : Obtenir API ID et API Hash</h4>
        <ol>
          <li>Allez sur <strong><a href="https://my.telegram.org/auth" target="_blank">https://my.telegram.org/auth</a></strong></li>
          <li>Connectez-vous avec votre num√©ro de t√©l√©phone</li>
          <li>Cliquez sur "API development tools"</li>
          <li>Remplissez le formulaire :
            <ul>
              <li>App title : <code>My Telegram Bot</code> (ou autre nom)</li>
              <li>Short name : <code>mybot</code> (ou autre)</li>
              <li>Platform : <code>Other</code></li>
            </ul>
          </li>
          <li>Vous recevrez <strong>api_id</strong> (nombre) et <strong>api_hash</strong> (texte)</li>
        </ol>
      </div>

      <div class="step-guide">
        <h4>üîê √âtape 2 : G√©n√©rer la Session String</h4>
        <ol>
          <li>Utilisez un g√©n√©rateur de session (ex: <strong><a href="https://tgsnake.js.org/login" target="_blank">https://tgsnake.js.org/login</a></strong>)</li>
          <li>Entrez votre <strong>api_id</strong> et <strong>api_hash</strong></li>
          <li>Entrez votre <strong>num√©ro de t√©l√©phone</strong></li>
          <li>Entrez le <strong>code SMS</strong> re√ßu</li>
          <li>Si activ√©, entrez votre <strong>mot de passe 2FA</strong></li>
          <li>Copiez la <strong>session string</strong> g√©n√©r√©e</li>
        </ol>
        <p style="color: #666; font-size: 14px; margin-top: 10px;">
          üí° <strong>Alternative :</strong> Utilisez le script de g√©n√©ration GramJS fourni dans la documentation.
        </p>
      </div>

      <form id="userbot-form">
        <h3>üîë Credentials Telegram</h3>
        
        <div class="form-group">
          <label for="apiId">API ID *</label>
          <input type="text" id="apiId" name="apiId" placeholder="123456" value="<%= config.apiId || '' %>" required>
          <p style="color: #888; font-size: 13px; margin-top: 5px;">
            Nombre obtenu depuis https://my.telegram.org
          </p>
        </div>

        <div class="form-group">
          <label for="apiHash">API Hash *</label>
          <input type="text" id="apiHash" name="apiHash" placeholder="abc123def456..." value="<%= config.apiHash || '' %>" required>
          <p style="color: #888; font-size: 13px; margin-top: 5px;">
            Texte obtenu depuis https://my.telegram.org
          </p>
        </div>

        <div class="form-group">
          <label for="phoneNumber">Num√©ro de t√©l√©phone *</label>
          <input type="text" id="phoneNumber" name="phoneNumber" placeholder="+33612345678" value="<%= config.phoneNumber || '' %>" required>
          <p style="color: #888; font-size: 13px; margin-top: 5px;">
            Format international avec le + (ex: +33612345678)
          </p>
        </div>

        <div class="form-group">
          <label for="sessionString">Session String *</label>
          <textarea id="sessionString" name="sessionString" rows="4" placeholder="Votre session string g√©n√©r√©e..." required><%= config.sessionString || '' %></textarea>
          <p style="color: #888; font-size: 13px; margin-top: 5px;">
            ‚ö†Ô∏è <strong>Ne partagez JAMAIS cette session string !</strong> Elle donne acc√®s complet √† votre compte Telegram.
          </p>
        </div>

        <div class="info-box">
          <strong>‚ÑπÔ∏è Note :</strong> Apr√®s avoir enregistr√© ces informations, le bot red√©marrera automatiquement en mode userbot.
          <br><br>
          Le bot utilisera votre compte Telegram pour envoyer et recevoir des messages comme un utilisateur normal.
        </div>

        <div style="margin-top: 30px;">
          <button type="submit" class="btn-primary">üíæ Enregistrer la configuration</button>
        </div>
      </form>

      <div id="userbot-status"></div>

      <% if (config.sessionString) { %>
      <div class="step-guide" style="margin-top: 40px;">
        <h4>‚úÖ Configuration actuelle</h4>
        <p>API ID : <code><%= config.apiId || 'Non configur√©' %></code></p>
        <p>API Hash : <code><%= config.apiHash ? config.apiHash.substring(0, 10) + '...' : 'Non configur√©' %></code></p>
        <p>T√©l√©phone : <code><%= config.phoneNumber || 'Non configur√©' %></code></p>
        <p>Session : <code><%= config.sessionString ? '‚úÖ Configur√©e' : '‚ùå Non configur√©e' %></code></p>
      </div>
      <% } %>
    </div>
  </div>

  <script>
    document.getElementById('userbot-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const apiId = document.getElementById('apiId').value.trim();
      const apiHash = document.getElementById('apiHash').value.trim();
      const phoneNumber = document.getElementById('phoneNumber').value.trim();
      const sessionString = document.getElementById('sessionString').value.trim();
      
      if (!apiId || !apiHash || !phoneNumber || !sessionString) {
        alert('Tous les champs sont obligatoires');
        return;
      }
      
      if (!phoneNumber.startsWith('+')) {
        alert('Le num√©ro de t√©l√©phone doit commencer par + (format international)');
        return;
      }
      
      const config = {
        apiId,
        apiHash,
        phoneNumber,
        sessionString
      };
      
      const statusDiv = document.getElementById('userbot-status');
      statusDiv.innerHTML = '<p class="loading">‚è≥ Enregistrement de la configuration userbot...</p>';
      
      try {
        const response = await fetch('/api/userbot-config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config)
        });
        
        const result = await response.json();
        
        if (result.success) {
          statusDiv.innerHTML = '<p class="success">‚úÖ Configuration enregistr√©e avec succ√®s! Le bot va red√©marrer...</p>';
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        } else {
          statusDiv.innerHTML = `<p class="error">‚ùå Erreur : ${result.error || 'Erreur lors de l\'enregistrement'}</p>`;
        }
      } catch (error) {
        statusDiv.innerHTML = '<p class="error">‚ùå Erreur lors de l\'enregistrement</p>';
      }
    });
  </script>
</body>
</html>
